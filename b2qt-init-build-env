#!/bin/sh
#############################################################################
##
## Copyright (C) 2014 Digia Plc and/or its subsidiary(-ies).
##
## This file is part of the Qt Enterprise Embedded Scripts of the Qt
## framework.
##
## $QT_BEGIN_LICENSE$
## Commercial License Usage Only
## Licensees holding valid commercial Qt license agreements with Digia
## with an appropriate addendum covering the Qt Enterprise Embedded Scripts,
## may use this file in accordance with the terms contained in said license
## agreement.
##
## For further information use the contact form at
## http://qt.digia.com/contact-us.
##
##
## $QT_END_LICENSE$
##
#############################################################################

set -e

if [ $# -ne 1 ]; then
    echo "Usage: $0 <yocto build directory>"
    exit 1
fi

mkdir -p ${1}

DIR=$(readlink -f $(dirname $0))
BUILDDIR=$(readlink -f $1)

checkout() {
    REPO=$1
    REPODIR=${REPO##*/}
    if [ ${REPODIR} != "poky" ]; then
        REPODIR="poky/${REPODIR}"
    fi
    REF=${2%%:*}
    SHA1=${2##*:}
    if [ ! -d ${BUILDDIR}/${REPODIR} ]; then
        mkdir ${BUILDDIR}/${REPODIR}
        cd ${BUILDDIR}/${REPODIR}
        git init
        git remote add origin ${REPO} -f
        git checkout ${REF}
        git reset --hard ${SHA1}
        cd -
    fi
}

checkout git://git.yoctoproject.org/poky                    "daisy:b2f045c400fa8bd20b319c60137b1575f967cef1"
checkout git://git.yoctoproject.org/meta-fsl-arm            "daisy:e9bf647e10ff1e31f911d3236dbb22a1ad7ace9f"
checkout git://github.com/Freescale/meta-fsl-arm-extra      "daisy:e041d9a118c5eecf4010bcb41bb5c554636090ab"
checkout git://git.yoctoproject.org/meta-ti                 "daisy:41457c50e21168faf04f3cdd4168954890d6cdab"
checkout git://github.com/beagleboard/meta-beagleboard      "master:b5c709b2b6bd3bf236df923fa8f245a00fbb1b60"
checkout git://git.yoctoproject.org/meta-raspberrypi        "daisy:946b69299737cc2f1378c864f1b9075280db1b53"
checkout git://git.toradex.com/meta-toradex                 "V2.2:b47dad6cf9bd5be5287dac3835ea037a2fd30cf7"
checkout git://git.openembedded.org/meta-openembedded       "daisy:662cf409c1175450699d498085f3c894e0fe81d0"

if [ ! -d ${BUILDDIR}/poky/meta-b2qt ]; then
    ln -s ${DIR} ${BUILDDIR}/poky/meta-b2qt
fi

echo
echo "Yocto build system is ready"
echo "next initialize the build env for your target machine, for example:"
echo
echo "cd ${BUILDDIR}"
echo "export TEMPLATECONF=meta-b2qt/conf"
echo "export MACHINE=raspberrypi"
echo ". ./poky/oe-init-build-env build-raspberrypi"
echo
echo "and build B2Qt image with:"
echo
echo "bitbake b2qt-embedded-image"
echo
